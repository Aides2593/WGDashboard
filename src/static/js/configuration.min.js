!function(){let b,c=0,d=$(".progress-bar"),a={keyboard:!1,backdrop:"static"},e=new bootstrap.Modal(document.getElementById("add_modal"),a),f=new bootstrap.Modal(document.getElementById("delete_bulk_modal"),a),g=new bootstrap.Modal(document.getElementById("available_ip_modal"),a),h=new bootstrap.Modal(document.getElementById("qrcode_modal"),a),i=new bootstrap.Modal(document.getElementById("setting_modal"),a),j=new bootstrap.Modal(document.getElementById("delete_modal"),a);function k(){b=setInterval(function(){t($("#search_peer_textbox").val())},c)}function l(){clearInterval(b)}function m(){d.css("width","0%").css("opacity","100").css("background","rgb(255,69,69)").css("background","linear-gradient(145deg, rgba(255,69,69,1) 0%, rgba(0,115,186,1) 100%)").css("width","25%"),setTimeout(function(){n()},300)}function n(){d.css("transition","3s ease-in-out").css("width","75%")}function o(){d.css("transition","0.3s ease-in-out").css("width","100%"),setTimeout(function(){d.css("opacity","0")},250)}function p(b,c){let a=10**c;return Math.round(b*a)/a}$("[data-toggle='tooltip']").tooltip(),$("[data-toggle='popover']").popover();let q=new Date,r=0,s=0;function t(a){m(),q=new Date,$.ajax({method:"GET",url:`/get_config/${conf_name}?search=${encodeURIComponent(a)}`,headers:{"Content-Type":"application/json"}}).done(function(b){var a;document.querySelectorAll(".no-response").forEach(a=>a.classList.remove("show")),document.querySelector("#right_body").classList.remove("no-responding"),document.querySelector(".navbar").classList.remove("no-responding"),setTimeout(function(){document.querySelectorAll(".no-response").forEach(a=>a.classList.remove("active"))},1010),peers=b.peer_data,function(c){if(""===c.listen_port&&"stopped"===c.status){let a=document.createElement("div");a.classList.add("alert"),a.classList.add("alert-warning"),a.setAttribute("role","alert"),a.innerHTML="Peer QR Code and configuration file download required a specified <strong>Listen Port</strong>.",document.querySelector("#config_info_alert").appendChild(a)}if("N/A"===c.conf_address){let b=document.createElement("div");b.classList.add("alert"),b.classList.add("alert-warning"),b.setAttribute("role","alert"),b.innerHTML="Configuration <strong>Address</strong> need to be specified to have peers connect to it.",document.querySelector("#config_info_alert").appendChild(b)}}(b);let d;a=b,d=document.getElementById("conf_status_btn"),"checked"===a.checked?d.innerHTML=`<a href="#" id="${a.name}" ${a.checked} class="switch text-primary"><i class="bi bi-toggle2-on"></i> ON</a>`:d.innerHTML=`<a href="#" id="${a.name}" ${a.checked} class="switch text-primary"><i class="bi bi-toggle2-off"></i> OFF</a>`,d.classList.remove("info_loading"),document.querySelectorAll("#sort_by_dropdown option").forEach(a=>a.removeAttribute("selected")),document.querySelector(`#sort_by_dropdown option[value="${a.sort_tag}"]`).setAttribute("selected","selected"),document.querySelectorAll(".interval-btn-group button").forEach(a=>a.classList.remove("active")),document.querySelector(`button[data-refresh-interval="${a.dashboard_refresh_interval}"]`).classList.add("active"),document.querySelectorAll(".display-btn-group button").forEach(a=>a.classList.remove("active")),document.querySelector(`button[data-display-mode="${a.peer_display_mode}"]`).classList.add("active"),document.querySelector("#conf_status").innerHTML=`${a.status}<span class="dot dot-${a.status}"></span>`,document.querySelector("#conf_connected_peers").innerHTML=a.running_peer,document.querySelector("#conf_total_data_usage").innerHTML=`${a.total_data_usage[0]} GB`,document.querySelector("#conf_total_data_received").innerHTML=`${a.total_data_usage[2]} GB`,document.querySelector("#conf_total_data_sent").innerHTML=`${a.total_data_usage[1]} GB`,document.querySelector("#conf_public_key").innerHTML=a.public_key,document.querySelector("#conf_listen_port").innerHTML=""===a.listen_port?"N/A":a.listen_port,document.querySelector("#conf_address").innerHTML=a.conf_address,document.querySelectorAll(".info h6").forEach(a=>a.classList.remove("info_loading")),function(a){let b="";if(0===a.peer_data.length)document.querySelector(".peer_list").innerHTML=`<div class="col-12" style="text-align: center; margin-top: 1.5rem"><h3 class="text-muted">Oops! No peers found ‘︿’</h3></div>`;else{let d="list"===a.peer_display_mode?"col-12":"col-sm-6 col-lg-4";a.peer_data.forEach(function(c){let g=0,h=0;g+=c.cumu_receive,h+=c.cumu_sent;let e='<div class="w-100"></div>',i='<div class="col-sm display" style="display: flex; align-items: center; margin-bottom: 0.2rem"><h5 style="margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(""===c.name?"Untitled":c.name)+'</h5><h6 style="text-transform: uppercase; margin: 0; margin-left: auto !important;"><span class="dot dot-'+c.status+'" style="margin-left: auto !important;" data-toggle="tooltip" data-placement="left" title="Peer Connected"></span></h6></div>',j='<div class="col-12 peer_data_group" style="text-align: right; display: flex; margin-bottom: 0.5rem"><p class="text-primary" style="text-transform: uppercase; margin-bottom: 0; margin-right: 1rem"><small><i class="bi bi-arrow-down-right"></i> '+p(c.total_receive+g,4)+' GB</small></p> <p class="text-success" style="text-transform: uppercase; margin-bottom: 0"><small><i class="bi bi-arrow-up-right"></i> '+p(c.total_sent+h,4)+" GB</small></p> </div>",k='<div class="col-sm"><small class="text-muted" style="display: flex"><strong>PEER</strong><strong style="margin-left: auto!important; opacity: 0; transition: 0.2s ease-in-out" class="text-primary">CLICK TO COPY</strong></small> <h6><samp class="ml-auto key">'+c.id+"</samp></h6></div>",l='<div class="col-sm"><small class="text-muted"><strong>ALLOWED IP</strong></small><h6 style="text-transform: uppercase;">'+c.allowed_ip+"</h6></div>",m='<div class="col-sm"> <small class="text-muted"><strong>LATEST HANDSHAKE</strong></small> <h6 style="text-transform: uppercase;">'+c.latest_handshake+"</h6> </div>",n='<div class="col-sm"><small class="text-muted"><strong>END POINT</strong></small><h6 style="text-transform: uppercase;">'+c.endpoint+"</h6></div>",f='<div class="col-sm"><hr><div class="button-group" style="display:flex"><button type="button" class="btn btn-outline-primary btn-setting-peer btn-control" id="'+c.id+'" data-toggle="modal"><i class="bi bi-gear-fill" data-toggle="tooltip" data-placement="bottom" title="Peer Settings"></i></button> <button type="button" class="btn btn-outline-danger btn-delete-peer btn-control" id="'+c.id+'" data-toggle="modal"><i class="bi bi-x-circle-fill" data-toggle="tooltip" data-placement="bottom" title="Delete Peer"></i></button>';""!==c.private_key&&(f+='<div class="share_peer_btn_group" style="margin-left: auto !important; display: inline"><button type="button" class="btn btn-outline-success btn-qrcode-peer btn-control" data-imgsrc="/qrcode/'+a.name+"?id="+encodeURIComponent(c.id)+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 19px;" fill="#28a745"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM17 17h2v2h-2zM19 19h2v2h-2zM15 19h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2z"/></svg></button><a href="/download/'+a.name+"?id="+encodeURIComponent(c.id)+'" class="btn btn-outline-info btn-download-peer btn-control"><i class="bi bi-download"></i></a></div>'),f+="</div>";let o='<div class="'+d+'" data-id="'+c.id+'"><div class="card mb-3 card-'+c.status+'"><div class="card-body"><div class="row">'+i+e+j+k+l+m+e+n+e+f+"</div></div></div></div></div>";b+=o}),document.querySelector(".peer_list").innerHTML=b,a.dashboard_refresh_interval!==c&&(c=a.dashboard_refresh_interval,l(),k())}}(b),$(".dot.dot-running").attr("title","Peer Connected").tooltip(),$(".dot.dot-stopped").attr("title","Peer Disconnected").tooltip(),$("i[data-toggle='tooltip']").tooltip(),o();let e=new Date-q;r+=e,s+=1,console.log(`Average ${r/s}ms`),$("#peer_loading_time").html(`Peer Loading Time: ${e}ms`)}).fail(function(){document.querySelectorAll(".no-response").forEach(a=>a.classList.add("active")),setTimeout(function(){document.querySelectorAll(".no-response").forEach(a=>a.classList.add("show")),document.querySelector("#right_body").classList.add("no-responding"),document.querySelector(".navbar").classList.add("no-responding")},10)})}function u(a){$("#alertToast").toast("show"),$("#alertToast .toast-body").html(a)}window.configurations={addModal:()=>e,deleteBulkModal:()=>f,deleteModal:()=>j,ipModal:()=>g,qrcodeModal:()=>h,settingModal:()=>i,loadPeers(a){t(a)},addPeersByBulk(){!function(){let a=$("#new_add_amount");$add_peer.setAttribute("disabled","disabled"),$add_peer.innerHTML=`Adding ${a.val()} peers...`;let b=$("#new_add_DNS");b.val(window.configurations.cleanIp(b.val()));let c=$("#new_add_endpoint_allowed_ip");c.val(window.configurations.cleanIp(c.val()));let e=$("#new_add_MTU"),f=$("#new_add_keep_alive"),j=$("#enable_preshare_key"),l=[b,c,e,f],g=$("#uploadConfigFile");if((a.val()>0||$("#bulkdddradio_list").prop("checked"))&&!a.hasClass("is-invalid")){if(""!==b.val()&&""!==c.val()){let k=$add_peer.getAttribute("conf_id"),d=[];if(a.val()>1)for(let h=0;h<a.val();h++)d.push(window.wireguard.generateKeypair());else{len=g.val().split("\n").length,console.log(len);for(let i=0;i<len;i++)d.push(window.wireguard.generateKeypair())}$.ajax({method:"POST",url:"/add_peer_bulk/"+k,headers:{"Content-Type":"application/json"},data:JSON.stringify({DNS:b.val(),endpoint_allowed_ip:c.val(),MTU:e.val(),keep_alive:f.val(),enable_preshared_key:j.prop("checked"),keys:d,amount:a.val(),list:g.val()}),success:function(b){"true"!==b?($("#add_peer_alert").html(b).removeClass("d-none"),l.forEach(a=>a.removeAttr("disabled")),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save"):(window.configurations.loadPeers(""),l.forEach(a=>a.removeAttr("disabled")),$("#add_peer_form").trigger("reset"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save",window.configurations.showToast(a.val()+" peers added successful!"),window.configurations.addModal().toggle())}})}else $("#add_peer_alert").html("Please fill in all required box.").removeClass("d-none"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Add"}else $add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Add"}()},deletePeers(c,d){var a,b;a=c,b=d,$.ajax({method:"POST",url:"/remove_peer/"+a,headers:{"Content-Type":"application/json"},data:JSON.stringify({action:"delete",peer_ids:b}),success:function(a){if("true"!==a){if(window.configurations.deleteModal()._isShown&&($("#remove_peer_alert").html(a+$("#add_peer_alert").html()).removeClass("d-none"),$("#delete_peer").removeAttr("disabled").html("Delete")),window.configurations.deleteBulkModal()._isShown){let b=$("#bulk_remove_peer_alert");b.html(a+b.html()).removeClass("d-none"),$("#confirm_delete_bulk_peers").removeAttr("disabled").html("Delete")}}else window.configurations.deleteModal()._isShown&&window.configurations.deleteModal().toggle(),window.configurations.deleteBulkModal()._isShown&&($("#confirm_delete_bulk_peers").removeAttr("disabled").html("Delete"),$("#selected_peer_list").html(""),$(".delete-bulk-peer-item.active").removeClass("active"),window.configurations.deleteBulkModal().toggle()),window.configurations.loadPeers($("#search_peer_textbox").val()),$("#alertToast").toast("show"),$("#alertToast .toast-body").html("Peer deleted!"),$("#delete_peer").removeAttr("disabled").html("Delete")}})},getAvailableIps(){$.ajax({url:`/available_ips/${$add_peer.getAttribute("conf_id")}`,method:"GET"}).done(function(a){available_ips=a;let b=document.querySelector("#available_ip_modal .modal-body .list-group");b.innerHTML="",document.querySelector("#allowed_ips").value=available_ips[0],available_ips.forEach(a=>b.innerHTML+=`<a class="list-group-item list-group-item-action available-ip-item" style="cursor: pointer" data-ip="${a}">${a}</a>`)})},generateKeyPair(){let a;a=window.wireguard.generateKeypair(),document.querySelector("#private_key").value=a.privateKey,document.querySelector("#public_key").value=a.publicKey,document.querySelector("#add_peer_alert").classList.add("d-none"),document.querySelector("#re_generate_key i").classList.remove("rotating"),document.querySelector("#enable_preshare_key").value=a.presharedKey},showToast(a){u(a)},updateRefreshInterval(d,e){var b,a;b=d,a=e,"true"===b?(c=a,l(),k(),u("Refresh Interval set to "+Math.round(a/1e3)+" seconds")):($(".interval-btn-group button").removeClass("active"),$('.interval-btn-group button[data-refresh-interval="'+c+'"]').addClass("active"),u("Refresh Interval set unsuccessful"))},copyToClipboard(c){var b;let a;b=c,a=$("<input>"),$body.append(a),a.val($(b).text()).trigger("select"),document.execCommand("copy"),a.remove()},toggleDeleteByBulkIP(e){var a;let c,b,d;a=e,c=$("#selected_peer_list"),b=a.data("id"),d=""===a.data("name")?"Untitled Peer":a.data("name"),a.hasClass("active")?(a.removeClass("active"),$("#selected_peer_list .badge[data-id='"+b+"']").remove()):(a.addClass("active"),c.append('<span class="badge badge-danger delete-peer-bulk-badge" style="cursor: pointer; text-overflow: ellipsis; max-width: 100%; overflow-x: hidden" data-id="'+b+'">'+d+" - "+b+"</span>"))},downloadOneConfig(d){var a;let b,c;a=d,(b=document.createElement("a")).download=a.filename,c=new Blob([a.content],{type:"text/conf"}),b.href=window.URL.createObjectURL(c),b.click()},triggerIp(c){var a;let b;a=c,(b=document.querySelector(`.available-ip-item[data-ip='${a}']`))&&(b.classList.contains("active")?(b.classList.remove("active"),document.querySelector(`#selected_ip_list .badge[data-ip='${a}']`).remove()):(b.classList.add("active"),document.querySelector("#selected_ip_list").innerHTML+=`<span class="badge badge-primary available-ip-badge" style="cursor: pointer" data-ip="${a}">${a}</span>`))},cleanIp:a=>(function(c){let a=c.split(",");for(let b=0;b<a.length;b++)a[b]=a[b].trim(" ");return a.filter(Boolean).join(",")})(a),startProgressBar(){m()},stillLoadingProgressBar(){n()},endProgressBar(){o()}}}();let $body=$("body"),available_ips=[],$add_peer=document.getElementById("save_peer");document.querySelector(".add_btn").addEventListener("click",()=>{window.configurations.addModal().toggle()}),document.querySelector(".info").addEventListener("click",b=>{let a=document.querySelector(".switch");a.contains(b.target)&&(a.style.display="none",document.querySelector("div[role=status]").style.display="inline-block",location.replace(`/switch/${a.getAttribute("id")}`))}),document.querySelector("#private_key").addEventListener("change",b=>{let a=document.querySelector("#public_key");44===b.target.value.length?(a.value=window.wireguard.generatePublicKey(b.target.value),a.setAttribute("disabled","disabled")):(a.attributes.removeNamedItem("disabled"),a.value="")}),$("#add_modal").on("show.bs.modal",function(){window.configurations.generateKeyPair(),window.configurations.getAvailableIps()}).on("hide.bs.modal",function(){$("#allowed_ips_indicator").html("")}),$("#re_generate_key").on("click",function(){$("#public_key").attr("disabled","disabled"),$("#re_generate_key i").addClass("rotating"),window.configurations.generateKeyPair()}),$("#allowed_ips").on("keyup",function(){let a=window.configurations.cleanIp($(this).val());a=a.split(","),available_ips.includes(a[a.length-1])?$("#allowed_ips_indicator").removeClass().addClass("text-success").html('<i class="bi bi-check-circle-fill"></i>'):$("#allowed_ips_indicator").removeClass().addClass("text-warning").html('<i class="bi bi-exclamation-circle-fill"></i>')}),$("#peer_name_textbox").on("keyup",function(){$(".peer_name").html($(this).val())}),$add_peer.addEventListener("click",function(){if($("#bulk_add").prop("checked"))$("#new_add_amount").hasClass("is-invalid")||window.configurations.addPeersByBulk();else{let d=$("#public_key"),e=$("#private_key"),a=$("#allowed_ips");a.val(window.configurations.cleanIp(a.val()));let b=$("#new_add_DNS");b.val(window.configurations.cleanIp(b.val()));let c=$("#new_add_endpoint_allowed_ip");c.val(window.configurations.cleanIp(c.val()));let f=$("#new_add_name"),g=$("#new_add_MTU"),h=$("#new_add_keep_alive"),i=$("#enable_preshare_key");if($add_peer.setAttribute("disabled","disabled"),$add_peer.innerHTML="Adding...",""!==a.val()&&""!==d.val()&&""!==b.val()&&""!==c.val()){let j=$add_peer.getAttribute("conf_id"),k=[e,a,f,b,c,g,h];k.forEach(a=>a.attr("disabled","disabled")),$.ajax({method:"POST",url:"/add_peer/"+j,headers:{"Content-Type":"application/json"},data:JSON.stringify({private_key:e.val(),public_key:d.val(),allowed_ips:a.val(),name:f.val(),DNS:b.val(),endpoint_allowed_ip:c.val(),MTU:g.val(),keep_alive:h.val(),enable_preshared_key:i.prop("checked"),preshared_key:i.val()}),success:function(a){"true"!==a?($("#add_peer_alert").html(a).removeClass("d-none"),k.forEach(a=>a.removeAttr("disabled")),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save"):(window.configurations.loadPeers(""),k.forEach(a=>a.removeAttr("disabled")),$("#add_peer_form").trigger("reset"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save",window.configurations.showToast("Add peer successful!"),window.configurations.addModal().toggle())}})}else $("#add_peer_alert").html("Please fill in all required box.").removeClass("d-none"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Add"}}),$("#new_add_amount").on("keyup",function(){let a=$("#bulk_amount_validation");$(this).val().length>0?isNaN($(this).val())?($(this).removeClass("is-valid").addClass("is-invalid"),a.html("Please enter a valid integer")):$(this).val()>available_ips.length?($(this).removeClass("is-valid").addClass("is-invalid"),a.html(`Cannot create more than ${available_ips.length} peers.`)):1>$(this).val()?($(this).removeClass("is-valid").addClass("is-invalid"),a.html("Please enter at least 1 or more.")):$(this).removeClass("is-invalid").addClass("is-valid"):$(this).removeClass("is-invalid").removeClass("is-valid")}),$("#bulk_add").on("change",function(){let a=$(".non-bulk").find("input"),f=$("#new_add_amount"),c=$("#bulkdddradio_random"),d=$("#bulkdddradio_list"),g=$("#uploadConfigFile");if(!0===$(this).prop("checked")){for(let e=0;e<a.length;e++)$(a[e]).attr("disabled","disabled");c.removeAttr("disabled"),d.removeAttr("disabled"),c.prop("checked")&&f.removeAttr("disabled"),d.prop("checked")&&g.removeAttr("disabled")}else{for(let b=0;b<a.length;b++)"public_key"!==$(a[b]).attr("id")&&$(a[b]).removeAttr("disabled");f.attr("disabled","disabled"),c.attr("disabled","disabled"),d.attr("disabled","disabled"),g.attr("disabled","disabled")}}),$(document).on("change",'input:radio[id^="bulkdddradio_"]',function(d){let c=$(this).val(),a=$("#new_add_amount"),b=$("#uploadConfigFile");"random"===c?(a.removeAttr("disabled"),b.attr("disabled","disabled")):(a.attr("disabled","disabled"),b.removeAttr("disabled"))}),$("#available_ip_modal").on("show.bs.modal",()=>{document.querySelector("#add_modal").classList.add("ip_modal_open")}).on("hidden.bs.modal",()=>{document.querySelector("#add_modal").classList.remove("ip_modal_open");let b=[],c=document.querySelector("#selected_ip_list");for(let a=0;a<c.childElementCount;a++)b.push(c.children[a].dataset.ip);b.forEach(a=>window.configurations.triggerIp(a))}),$body.on("click",".available-ip-badge",function(){$(".available-ip-item[data-ip='"+$(this).data("ip")+"']").removeClass("active"),$(this).remove()}),$body.on("click",".available-ip-item",function(){window.configurations.triggerIp($(this).data("ip"))}),$("#search_available_ip").on("click",function(){window.configurations.ipModal().toggle();let c=document.querySelector("#allowed_ips");if(c.value.length>0){let b=c.value.split(",");for(let a=0;a<b.length;a++)b[a]=b[a].trim(),window.configurations.triggerIp(b[a])}}).tooltip(),$("#confirm_ip").on("click",()=>{window.configurations.ipModal().toggle();let a=[];$("#selected_ip_list").children().each(function(){a.push($(this).data("ip"))}),$("#allowed_ips").val(a.join(", ")),a.forEach(a=>window.configurations.triggerIp(a))}),$body.on("click",".btn-qrcode-peer",function(){let a=$(this).data("imgsrc");$.ajax({url:a,method:"GET"}).done(function(a){$("#qrcode_img").attr("src",a),window.configurations.qrcodeModal().toggle()})}),$body.on("click",".btn-delete-peer",function(){let a=$(this).attr("id");$("#delete_peer").attr("peer_id",a),window.configurations.deleteModal().toggle()}),$("#delete_peer").on("click",function(){$(this).attr("disabled","disabled"),$(this).html("Deleting...");let a=$(this).attr("peer_id"),b=$(this).attr("conf_id");window.configurations.deletePeers(b,[a])}),$body.on("click",".btn-setting-peer",function(){window.configurations.startProgressBar();let a=$(this).attr("id");$("#save_peer_setting").attr("peer_id",a),$.ajax({method:"POST",url:"/get_peer_data/"+$("#setting_modal").attr("conf_id"),headers:{"Content-Type":"application/json"},data:JSON.stringify({id:a}),success:function(a){let b=""===a.name?"Untitled":a.name;$("#setting_modal .peer_name").html(b),$("#setting_modal #peer_name_textbox").val(a.name),$("#setting_modal #peer_private_key_textbox").val(a.private_key),$("#setting_modal #peer_DNS_textbox").val(a.DNS),$("#setting_modal #peer_allowed_ip_textbox").val(a.allowed_ip),$("#setting_modal #peer_endpoint_allowed_ips").val(a.endpoint_allowed_ip),$("#setting_modal #peer_mtu").val(a.mtu),$("#setting_modal #peer_keep_alive").val(a.keep_alive),$("#setting_modal #peer_preshared_key_textbox").val(a.preshared_key),window.configurations.settingModal().toggle(),window.configurations.endProgressBar()}})}),$("#setting_modal").on("hidden.bs.modal",function(){$("#setting_peer_alert").addClass("d-none")}),$("#peer_private_key_textbox").on("change",function(){let a=$("#save_peer_setting");$(this).val().length>0&&$.ajax({url:"/check_key_match/"+a.attr("conf_id"),method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({private_key:$("#peer_private_key_textbox").val(),public_key:a.attr("peer_id")})}).done(function(a){"failed"===a.status?$("#setting_peer_alert").html(a.status).removeClass("d-none"):$("#setting_peer_alert").addClass("d-none")})}),$("#save_peer_setting").on("click",function(){$(this).attr("disabled","disabled"),$(this).html("Saving...");let a=$("#peer_DNS_textbox"),b=$("#peer_allowed_ip_textbox"),c=$("#peer_endpoint_allowed_ips"),d=$("#peer_name_textbox"),e=$("#peer_private_key_textbox"),f=$("#peer_preshared_key_textbox"),g=$("#peer_mtu"),h=$("#peer_keep_alive");if(""!==a.val()&&""!==b.val()&&""!==c.val()){let i=$(this).attr("peer_id"),j=$(this).attr("conf_id"),k=[d,a,e,f,b,c,g,h];k.forEach(a=>a.attr("disabled","disabled")),$.ajax({method:"POST",url:"/save_peer_setting/"+j,headers:{"Content-Type":"application/json"},data:JSON.stringify({id:i,name:d.val(),DNS:a.val(),private_key:e.val(),allowed_ip:b.val(),endpoint_allowed_ip:c.val(),MTU:g.val(),keep_alive:h.val(),preshared_key:f.val()}),success:function(a){"failed"===a.status?$("#setting_peer_alert").html(a.msg).removeClass("d-none"):(window.configurations.settingModal().toggle(),window.configurations.loadPeers($("#search_peer_textbox").val()),$("#alertToast").toast("show"),$("#alertToast .toast-body").html("Peer Saved!")),$("#save_peer_setting").removeAttr("disabled").html("Save"),k.forEach(a=>a.removeAttr("disabled"))}})}else $("#setting_peer_alert").html("Please fill in all required box.").removeClass("d-none"),$("#save_peer_setting").removeAttr("disabled").html("Save")}),$(".peer_private_key_textbox_switch").on("click",function(){let a=$("#peer_private_key_textbox"),b="password"===a.attr("type")?"text":"password",c="password"===a.attr("type")?"bi bi-eye-slash-fill":"bi bi-eye-fill";a.attr("type",b),$(".peer_private_key_textbox_switch i").removeClass().addClass(c)});let typingTimer,doneTypingInterval=200;$("#search_peer_textbox").on("keyup",function(){clearTimeout(typingTimer),typingTimer=setTimeout(()=>{window.configurations.loadPeers($(this).val())},doneTypingInterval)}).on("keydown",function(){clearTimeout(typingTimer)}),$body.on("change","#sort_by_dropdown",function(){$.ajax({method:"POST",data:JSON.stringify({sort:$("#sort_by_dropdown option:selected").val()}),headers:{"Content-Type":"application/json"},url:"/update_dashboard_sort",success:function(){window.configurations.loadPeers($("#search_peer_textbox").val())}})}),$body.on("mouseenter",".key",function(){$(this).parent().siblings().children()[1].style.opacity="100"}).on("mouseout",".key",function(){let a=$(this).parent().siblings().children()[1];a.style.opacity="0",setTimeout(function(){a.innerHTML="CLICK TO COPY"},200)}).on("click",".key",function(){let a=$(this).parent().siblings().children()[1];window.configurations.copyToClipboard($(this)),a.innerHTML="COPIED!"}),$body.on("click",".update_interval",function(){$(".interval-btn-group button").removeClass("active"),$(this).addClass("active");let a=$(this).data("refresh-interval");$.ajax({method:"POST",data:"interval="+$(this).data("refresh-interval"),url:"/update_dashboard_refresh_interval",success:function(b){window.configurations.updateRefreshInterval(b,a)}})}),$body.on("click",".refresh",function(){window.configurations.loadPeers($("#search_peer_textbox").val())}),$body.on("click",".display_mode",function(){$(".display-btn-group button").removeClass("active"),$(this).addClass("active");let a=$(this).data("display-mode");$.ajax({method:"GET",url:"/switch_display_mode/"+$(this).data("display-mode"),success:function(b){"true"===b&&("list"===a?(Array($(".peer_list").children()).forEach(function(a){$(a).removeClass().addClass("col-12")}),window.configurations.showToast("Displaying as List")):(Array($(".peer_list").children()).forEach(function(a){$(a).removeClass().addClass("col-sm-6 col-lg-4")}),window.configurations.showToast("Displaying as Grids")))}})});let $setting_btn_menu=$(".setting_btn_menu");$setting_btn_menu.css("top",-(($setting_btn_menu.height()+54)*1));let $setting_btn=$(".setting_btn");$setting_btn.on("click",function(){$setting_btn_menu.hasClass("show")?($setting_btn_menu.removeClass("showing"),setTimeout(function(){$setting_btn_menu.removeClass("show")},201)):($setting_btn_menu.addClass("show"),setTimeout(function(){$setting_btn_menu.addClass("showing")},10))}),$("html").on("click",function(a){document.querySelector(".setting_btn")===a.target||document.querySelector(".setting_btn").contains(a.target)||document.querySelector(".setting_btn_menu").contains(a.target)||($setting_btn_menu.removeClass("showing"),setTimeout(function(){$setting_btn_menu.removeClass("show")},310))}),$("#delete_peers_by_bulk_btn").on("click",()=>{let a=$("#delete_bulk_modal .list-group");a.html(""),peers.forEach(b=>{let c;c=""===b.name?"Untitled Peer":b.name,a.append('<a class="list-group-item list-group-item-action delete-bulk-peer-item" style="cursor: pointer" data-id="'+b.id+'" data-name="'+c+'">'+c+"<br><code>"+b.id+"</code></a>")}),window.configurations.deleteBulkModal().toggle()}),$body.on("click",".delete-bulk-peer-item",function(){window.configurations.toggleDeleteByBulkIP($(this))}).on("click",".delete-peer-bulk-badge",function(){window.configurations.toggleDeleteByBulkIP($(".delete-bulk-peer-item[data-id='"+$(this).data("id")+"']"))});let $selected_peer_list=document.getElementById("selected_peer_list"),changeObserver=new MutationObserver(function(){$selected_peer_list.hasChildNodes()?$("#confirm_delete_bulk_peers").removeAttr("disabled"):$("#confirm_delete_bulk_peers").attr("disabled","disabled")});changeObserver.observe($selected_peer_list,{attributes:!0,childList:!0,characterData:!0});let confirm_delete_bulk_peers_interval;$("#confirm_delete_bulk_peers").on("click",function(){let a=$(this);if(void 0!==confirm_delete_bulk_peers_interval)clearInterval(confirm_delete_bulk_peers_interval),confirm_delete_bulk_peers_interval=void 0,a.html("Delete");else{let b=5;a.html(`Deleting in ${b} secs... Click to cancel`),confirm_delete_bulk_peers_interval=setInterval(function(){if(b-=1,a.html(`Deleting in ${b} secs... Click to cancel`),0===b){a.html("Deleting..."),a.attr("disabled","disabled");let c=[];$selected_peer_list.childNodes.forEach(a=>c.push(a.dataset.id)),window.configurations.deletePeers(a.data("conf"),c),clearInterval(confirm_delete_bulk_peers_interval),confirm_delete_bulk_peers_interval=void 0}},1e3)}}),$("#select_all_delete_bulk_peers").on("click",function(){$(".delete-bulk-peer-item").each(function(){$(this).hasClass("active")||window.configurations.toggleDeleteByBulkIP($(this))})}),$(window.configurations.deleteBulkModal()._element).on("hidden.bs.modal",function(){$(".delete-bulk-peer-item").each(function(){$(this).hasClass("active")&&window.configurations.toggleDeleteByBulkIP($(this))})}),$body.on("click",".btn-download-peer",function(a){a.preventDefault();let b=$(this).attr("href");$.ajax({url:b,method:"GET",success:function(a){window.configurations.downloadOneConfig(a)}})}),$("#download_all_peers").on("click",function(){$.ajax({url:$(this).data("url"),method:"GET",success:function(a){a.peers.length>0?(window.wireguard.generateZipFiles(a),window.configurations.showToast("Peers' zip file download successful!")):window.configurations.showToast("Oops! There are no peer can be download.")}})})